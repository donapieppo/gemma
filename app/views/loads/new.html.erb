<% @stock_possible = (! @thing.has_operation?) %>  
<% @all_ddts = current_organization.ddts.includes(:supplier).order('ddts.number desc').where('date > (NOW() - INTERVAL 366 DAY)') %>

<% if @stock_possible %>
  <p class="alert alert-warning">
  <%= dmicon('exclamation-circle', size: 36) %> <strong>Attenzione!</strong> 
  Non è ancora stato registrato alcun carico di questo materiale.<br/>
  Per indicare che questo carico proviene da una <strong>giacenza iniziale</strong>, scegliere 
  <%= link_to "Carico da Giacenza Iniziale", new_thing_stock_path(@thing), class: 'btn btn-success' %>.
  </p>
<% end %>

<%= render Thing::ActionsComponent.new(current_user, @thing) %>

<%= dm_form_for [@thing, @load], title: "Modulo di carico di #{@thing}" do |o| %>
  <%= o.dm_error_notification %>  
  <%= o.association :ddt, collection: @all_ddts, label_method: :description_with_date, required: true, hint: "Ddt/Fattura con cui è arrivato il materiale oppure crea un #{link_to 'nuovo ddt.', new_ddt_path}".html_safe %>

  <%= render 'loads/numbers_form', o: o %>  

  <%= o.input :date, as: :date, html5: true %>
  <% if current_organization.pricing %>  
    <%= o.input :price, as: :price, hint: 'Euro e centesimi' %>
  <% end %>
  <%= o.input :ycia,  as: :rif_cia, hint: 'Anno / numero' %>  
  <%= o.input :note %>

  <%= o.submit %> - <%= link_to_back thing_moves_path(@thing) %>  
  <%= thing_image(@thing) %>  
<% end %>

