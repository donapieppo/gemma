<h1><%= current_organization.description %> <small><%= current_organization.id %></small></h1>

<%= render partial: 'form' %>

<%= dm_card title: "Utenti" do %>
  <dl>
    <% @permissions_hash.each do |authlevel, permissions| %>
      <dt><%= Authorization.level_description(authlevel).upcase %></dt>
      <dd>
      <%= permissions.map{|p| p.user.to_s}.join(', ') %>
      </dd>
    <% end %>
    <% if current_user.is_cesia? %>  
      <%= link_to 'Modifica', dm_unibo_common.organization_permissions_path(current_organization), class: 'btn btn-primary' %>  
    <% end %>
  </dl>
<% end %>

<div class="row">
  <div class="col-md-6">
    <h2>Categorie</h2>
    <div class="list-group mb-3">
      <% current_organization.groups.order('groups.name').each do |group| %>  
        <div class="list-group-item py-2">
          <%= link_to group, group_things_path(group) %>
          <span class="float-end">
            <%= link_to_edit [:edit, group] %>
            <% if group.things.empty? %>  
              <%= link_to_delete group_path(group) %>  
            <% end %>
          </span>
        </div>
      <% end %>
    </div>

    <p>
    <%= link_to_new 'Nuova categoria', new_group_path %> - 
    <%= link_to dmicon('cut') + ' Mostra materiale senza movimentazioni', inactive_things_path, class: :button %>
    </p>
  </div>
  <div class="col-md-6">

    <h2>Ubicazioni</h2>
    <div class="list-group mb-3">
      <% current_organization.locations.order('name').each do |location| %>  
        <div class="list-group-item py-2">
          <%= link_to location, location_things_path(location) %>
          <span class="float-end">
            <% if location.deposits.empty? %>  
              <%= link_to link_to_delete location_path(location) %>
            <% end %>
            <%= link_to_edit edit_location_path(location), modal: true %>
          </span>
        </div>
      <% end %>
    </div>

    <p>
    <%= link_to_new 'Nuova ubicazione', new_location_path %> 
    </p>
  </div>
</div>

<p class="alert alert-info">
<strong><%= @operations_number %></strong> operazioni nell'anno corrente (<strong><%= @arch_number %></strong> in archivio).
</p>

<div class="row">
  <div class="col-md-8">
    <%= dm_card title: "Ultimi movimenti" do %> 
      <ul>
        <% @operations.each do |o| %>  
          <li title="<%= o.thing %>">
            <%= l o.date %> - <%= o.user %> <%= " per #{o.recipient}" if o.recipient_id %> 
            (<%= t o.type %>) <%= o.price if current_organization.pricing %>
          </li>
        <% end %>
      </ul>
    <% end %>
  </div>
  <div class="col-md-4">
    <%= dm_card title: "Ultimi ddt/fatture" do  %>  
      <ul>
        <% for ddt in @ddts do %>  
          <li><%= ddt.gen %> n.<%= ddt.number %> del <%= l ddt.date %></li>
        <% end %>
      </ul>
    <% end %>
  </div>
</div>

<% if current_user.is_cesia? %>  
  <%= link_to "Elimina la struttura", dm_unibo_common.organization_path(current_organization), method: :delete, class: :button %>  
<% end %>


